<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Creators | Content Hub</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script type="module" src="https://rw-501.github.io/contenthub/js/creators.js" defer></script>
  <script type="module" src="https://rw-501.github.io/contenthub/js/firebase-config.js" defer></script>
  <link rel="stylesheet" href="https://rw-501.github.io/contenthub/css/main.css" />

</head>
<body>


        <div id="toolbarContainer"></div>

  <!-- Your page content here -->

  <!-- Include Bootstrap JS (required for navbar) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Inject toolbar -->
  <script type="module">
    const toolbarContainer = document.getElementById("toolbarContainer");
    const html = await fetch('https://rw-501.github.io/contenthub/includes/nav.html').then(res => res.text());
    toolbarContainer.innerHTML = html;
    import('https://rw-501.github.io/contenthub/includes/nav.js');
  </script>


<!-- Main Section -->
  <main id="main">

<div class="container py-4">

    <div class="flex-md-row mb-4">

      <div class="d-flex flex-wrap gap-2 mb-1">
      <h2 class="fw-bold">Creators</h2>
        <input type="text" id="searchInput" class="form-control" placeholder="Search by name or tag...">
      </div>
   

<!-- 🔎 Multi-Select Filters UI -->
<div id="activeFilters" class="d-flex flex-wrap gap-2 my-3"></div>

      <div class="d-flex align-items-center gap-2 m-4">
        <select id="contentTypeFilter" class="form-select">
  <option value="">All Content Types</option>
  <option value="tutorials">Tutorials</option>
  <option value="vlogs">Vlogs</option>
  <option value="skits">Skits</option>
  <option value="podcasts">Podcasts</option>
  <option value="reviews">Reviews</option>
  <option value="livestreams">Livestreams</option>
  <option value="short reels">Short Reels</option>
  <option value="unboxings">Unboxings</option>
  <option value="behind-the-scenes">Behind-the-Scenes</option>
  <option value="storytimes">Storytimes</option>
  <option value="challenges">Challenges</option>
  <option value="interviews">Interviews</option>
  <option value="q&a">Q&A</option>
  <option value="comedy sketches">Comedy Sketches</option>
  <option value="news recaps">News Recaps</option>
  <option value="animations">Animations</option>
  <option value="music videos">Music Videos</option>
</select>

<select id="nicheFilter" class="form-select">
  <option value="">All Niches</option>
  <option value="music">Music</option>
  <option value="gaming">Gaming</option>
  <option value="fashion">Fashion</option>
  <option value="fitness">Fitness</option>
  <option value="comedy">Comedy</option>
  <option value="lifestyle">Lifestyle</option>
  <option value="tutorials">Tutorials</option>
  <option value="vlogging">Vlogging</option>
  <option value="tech">Tech</option>
  <option value="beauty">Beauty</option>
  <option value="education">Education</option>
  <option value="food & cooking">Food & Cooking</option>
  <option value="travel">Travel</option>
  <option value="motivation">Motivation</option>
  <option value="health & wellness">Health & Wellness</option>
  <option value="diy & crafts">DIY & Crafts</option>
  <option value="finance & investing">Finance & Investing</option>
  <option value="parenting">Parenting</option>
  <option value="photography">Photography</option>
  <option value="pets & animals">Pets & Animals</option>
  <option value="art & design">Art & Design</option>
  <option value="product reviews">Product Reviews</option>
  <option value="unboxing">Unboxing</option>
  <option value="asmr">ASMR</option>
  <option value="skits & acting">Skits & Acting</option>
  <option value="memes">Memes</option>
  <option value="spirituality">Spirituality</option>
  <option value="cars & motorsports">Cars & Motorsports</option>
  <option value="real estate">Real Estate</option>
  <option value="book reviews">Book Reviews</option>
</select>

<select id="locationFilter" class="form-select">
  <option value="">All Locations</option>
  <option value="Alabama">Alabama</option>
  <option value="Alaska">Alaska</option>
  <option value="Arizona">Arizona</option>
  <option value="Arkansas">Arkansas</option>
  <option value="California">California</option>
  <option value="Colorado">Colorado</option>
  <option value="Connecticut">Connecticut</option>
  <option value="Delaware">Delaware</option>
  <option value="Florida">Florida</option>
  <option value="Georgia">Georgia</option>
  <option value="Hawaii">Hawaii</option>
  <option value="Idaho">Idaho</option>
  <option value="Illinois">Illinois</option>
  <option value="Indiana">Indiana</option>
  <option value="Iowa">Iowa</option>
  <option value="Kansas">Kansas</option>
  <option value="Kentucky">Kentucky</option>
  <option value="Louisiana">Louisiana</option>
  <option value="Maine">Maine</option>
  <option value="Maryland">Maryland</option>
  <option value="Massachusetts">Massachusetts</option>
  <option value="Michigan">Michigan</option>
  <option value="Minnesota">Minnesota</option>
  <option value="Mississippi">Mississippi</option>
  <option value="Missouri">Missouri</option>
  <option value="Montana">Montana</option>
  <option value="Nebraska">Nebraska</option>
  <option value="Nevada">Nevada</option>
  <option value="New Hampshire">New Hampshire</option>
  <option value="New Jersey">New Jersey</option>
  <option value="New Mexico">New Mexico</option>
  <option value="New York">New York</option>
  <option value="North Carolina">North Carolina</option>
  <option value="North Dakota">North Dakota</option>
  <option value="Ohio">Ohio</option>
  <option value="Oklahoma">Oklahoma</option>
  <option value="Oregon">Oregon</option>
  <option value="Pennsylvania">Pennsylvania</option>
  <option value="Rhode Island">Rhode Island</option>
  <option value="South Carolina">South Carolina</option>
  <option value="South Dakota">South Dakota</option>
  <option value="Tennessee">Tennessee</option>
  <option value="Texas">Texas</option>
  <option value="Utah">Utah</option>
  <option value="Vermont">Vermont</option>
  <option value="Virginia">Virginia</option>
  <option value="Washington">Washington</option>
  <option value="West Virginia">West Virginia</option>
  <option value="Wisconsin">Wisconsin</option>
  <option value="Wyoming">Wyoming</option>
</select>


<select id="platformFilter" class="form-select">
  <option value="">All Platforms</option>
  <option value="instagram">Instagram</option>
  <option value="tiktok">TikTok</option>
  <option value="youtube">YouTube</option>
  <option value="facebook">Facebook</option>
  <option value="twitch">Twitch</option>
  <option value="threads">Threads</option>
  <option value="snapchat">Snapchat</option>
  <option value="pinterest">Pinterest</option>
  <option value="reddit">Reddit</option>
</select>


      </div>

      <!-- 🔁 Reset Filters Button -->
<div class="mb-3">
  <button class="btn btn-outline-secondary btn-sm" id="resetFiltersBtn">Reset Filters</button>
</div>

    </div>

    <div class="row g-4" id="creatorsGrid">
      <!-- Creator cards injected here -->
    </div>

</div>

  </main>

<!-- Add this at the bottom of <body> -->
<div id="footerContainer"></div>

<script type="module">
  const footer = await fetch('https://rw-501.github.io/contenthub/includes/footer.html').then(res => res.text());
  document.getElementById('footerContainer').innerHTML = footer;
  import('https://rw-501.github.io/contenthub/includes/footer.js');
</script>



  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { db, auth, sendNotification  } from 'https://rw-501.github.io/contenthub/js/firebase-config.js';

// 🔧 JavaScript Enhancements


const creatorsGrid = document.getElementById("creatorsGrid");
const searchInput = document.getElementById("searchInput");
const contentTypeFilter = document.getElementById("contentTypeFilter");
const nicheFilter = document.getElementById("nicheFilter");
const locationFilter = document.getElementById("locationFilter");
const platformFilter = document.getElementById("platformFilter");
const activeFilters = document.getElementById("activeFilters");
const resetFiltersBtn = document.getElementById("resetFiltersBtn");

let creators = [];
let activeFilterTags = [];

    async function fetchCreators() {
      const snapshot = await getDocs(collection(db, "users"));
      creators = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderCreators(creators);
    }

function decodeHTML(str) {
  const txt = document.createElement("textarea");
  txt.innerHTML = str;
  return txt.value;
}

function filterCreators() {
  const search = searchInput.value.toLowerCase();
  const tagsByType = activeFilterTags.reduce((acc, f) => {
    acc[f.type] = acc[f.type] || [];
    acc[f.type].push(f.value.toLowerCase().trim());
    return acc;
  }, {});

  let visibleCount = 0;

  document.querySelectorAll("#creatorsGrid > div").forEach(card => {
    const name = (card.dataset.name || "").toLowerCase();
    const rawNiches = decodeHTML(card.dataset.niche || "");
    const rawContent = decodeHTML(card.dataset.content || "");
    const location = (card.dataset.location || "").toLowerCase();

const nicheList = rawNiches.split(",").map(n => n.trim().toLowerCase());
const contentList = rawContent.split(",").map(c => c.trim().toLowerCase());

console.log("Niches:", rawNiches, "→", nicheList);
console.log("Content Types:", rawContent, "→", contentList);


    const matchesSearch = name.includes(search);
    const matchesNiche = !tagsByType.niche || tagsByType.niche.some(tag => nicheList.includes(tag));
    const matchesContent = !tagsByType.content || tagsByType.content.some(tag => contentList.includes(tag));
    const matchesLocation = !locationFilter.value || location === locationFilter.value.toLowerCase();

    const visible = matchesSearch && matchesNiche && matchesContent && matchesLocation;

    card.style.display = visible ? "block" : "none";
    if (visible) visibleCount++;
  });

  updateActiveFilters();

  const noResults = document.getElementById("noResultsMessage");
  if (!noResults) {
    const msg = document.createElement("p");
    msg.id = "noResultsMessage";
    msg.className = "text-center small mt-4";
    msg.textContent = "No creators match your filters.";
    creatorsGrid.appendChild(msg);
  }

  document.getElementById("noResultsMessage").style.display = visibleCount === 0 ? "block" : "none";
}


function addFilterTag(type, value) {
  if (activeFilterTags.find(f => f.type === type && f.value === value)) return;

  const tag = document.createElement("span");
  tag.className = "badge rounded-pill bg-primary text-white px-3 py-2 d-flex align-items-center";
  tag.innerHTML = `${value} <button type="button" class="btn-close btn-close-white ms-2" aria-label="Remove"></button>`;

  tag.querySelector(".btn-close").addEventListener("click", () => {
    activeFilterTags = activeFilterTags.filter(f => !(f.type === type && f.value === value));
    filterCreators();
  });

  activeFilters.appendChild(tag);
  activeFilterTags.push({ type, value });
  filterCreators();
}

function resetAllFilters() {
  activeFilterTags = [];
  searchInput.value = "";
  nicheFilter.value = "";
  contentTypeFilter.value = "";
  locationFilter.value = "";
  platformFilter.value = "";
  filterCreators();
}

function renderCreators(data) {
  creatorsGrid.innerHTML = "";
  activeFilters.innerHTML = "";

  if (data.length === 0) {
    creatorsGrid.innerHTML = '<p class="text-center text-muted small text-light">No creators found.</p>';
    return;
  }

  data.forEach(user => {
    const isVerified = user.verified === true;
    const verifiedPlatforms = user.verifiedPlatforms || {};
    const badge = isVerified ? `<span class="ms-1 text-primary" title="Verified"><i class="bi bi-patch-check-fill"></i></span>` : '';

    const platformIcons = Object.entries(verifiedPlatforms)
      .filter(([_, verified]) => verified)
      .map(([platform]) => {
        const icons = {
          instagram: "bi bi-instagram", tiktok: "bi bi-tiktok", youtube: "bi bi-youtube",
          facebook: "bi bi-facebook", twitter: "bi bi-twitter", linkedin: "bi bi-linkedin",
          twitch: "bi bi-twitch", threads: "bi bi-threads", snapchat: "bi bi-snapchat",
          pinterest: "bi bi-pinterest", reddit: "bi bi-reddit", other: "bi bi-link-45deg"
        };
        return `<i class="${icons[platform] || ''} text-muted ms-1" title="Verified on ${platform}"></i>`;
      }).join('');

    const userNiches = (user.niches || []).map(n =>
      `<span class="badge bg-light text-dark border me-1 niche-badge" data-niche="${n.toLowerCase()}">${n}</span>`
    ).join('');

    const userContent = (user.contentTypes || []).map(ct =>
      `<span class="badge bg-secondary text-light me-1 content-type-badge" data-content="${ct.toLowerCase()}">${ct}</span>`
    ).join('');

    const avatarBorder = user.online ? 'border-success border-2' : 'border-0';

    const location = user.userLocation?.city || user.userLocation?.state
      ? `${user.userLocation?.city || ''}${user.userLocation?.city && user.userLocation?.state ? ', ' : ''}${user.userLocation?.state || ''}`
      : '';

    const card = document.createElement("div");
    card.className = "col-sm-6 col-md-4 col-lg-4 mb-3";
    card.dataset.name = `${user.displayName?.toLowerCase() || ''} ${user.username?.toLowerCase() || ''}`;
    card.dataset.niche = (user.niches || []).join(',').toLowerCase();
    card.dataset.content = (user.contentTypes || []).join(',').toLowerCase();
    card.dataset.location = (user.userLocation?.state || '').toLowerCase();

    card.innerHTML = `
      <a href="https://rw-501.github.io/contenthub/pages/profile.html?uid=${user.id}" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <div class="text-center pt-3">
            <img src="${user.photoURL || '/assets/default-avatar.png'}"
              class="rounded-circle border ${avatarBorder}"
              style="width: 100px; height: 100px; object-fit: cover;"
              alt="${user.displayName || 'User'}" />
          </div>
          <div class="card-body text-center">
            <h6 class="card-title mb-0">${user.displayName || 'Unnamed'} ${badge} ${platformIcons}</h6>
            <small class="text-muted d-block mt-2">${location}</small>
            <small class="text-muted d-block mb-1">${user.availability || 'Available'}</small>
            <div class="flex-wrap gap-1 mt-2">${userNiches}</div>
            <div class="flex-wrap gap-1 mt-2">${userContent}</div>
          </div>
        </div>
      </a>
    `;
    creatorsGrid.appendChild(card);
  });

  document.querySelectorAll('.niche-badge').forEach(badge => {
    badge.addEventListener('click', () => addFilterTag('niche', badge.dataset.niche));
  });
  document.querySelectorAll('.content-type-badge').forEach(badge => {
    badge.addEventListener('click', () => addFilterTag('content', badge.dataset.content));
  });


}

function handleExploreSearchParam() {
  const params = new URLSearchParams(window.location.search);
  const searchInput = document.getElementById("searchInput");

  if (!searchInput) return;

  // Priority: location > niche > type
  let searchValue = "";

  if (params.has("location")) {
    searchValue = params.get("location").replace(/-/g, " ");
  } else if (params.has("niche")) {
    searchValue = params.get("niche");
  } else if (params.has("type")) {
    searchValue = params.get("type");
  }



  if (searchValue) {
    searchInput.value = decodeURIComponent(searchValue);

    // Optional: Trigger search
    setTimeout(() => {
      if (typeof triggerSearch === "function") {
  if (params.has("location")) {
    searchValue = params.get("location").replace(/-/g, " ");
  } else if (params.has("niche")) {
    addFilterTag('niche', searchValue);
  } else if (params.has("type")) {
    addFilterTag('content', searchValue);
  }

      } else {
        searchInput.dispatchEvent(new Event("input"));
      }
    }, 100);
  }
}

function updateActiveFilters() {
  const filtersDiv = document.getElementById("activeFilters");
  filtersDiv.innerHTML = ""; // Clear previous filters

  const filters = [];

  if (searchInput.value) {
    filters.push({ label: `Search: ${searchInput.value}`, key: "search" });
  }
  if (nicheFilter.value) {
    filters.push({ label: `Niche: ${nicheFilter.value}`, key: "niche" });
  }
  if (contentTypeFilter.value) {
    filters.push({ label: `Content: ${contentTypeFilter.value}`, key: "contentType" });
  }
  if (locationFilter.value) {
    filters.push({ label: `Location: ${locationFilter.value}`, key: "location" });
  }
  if (platformFilter.value) {
    filters.push({ label: `Platform: ${platformFilter.value}`, key: "platform" });
  }

  filters.forEach(filter => {
    const tag = document.createElement("span");
    tag.className = "badge bg-secondary text-white d-flex align-items-center gap-1";
    tag.innerHTML = `
      ${filter.label}
      <button type="button" class="btn-close btn-close-white btn-sm" aria-label="Remove"
        data-key="${filter.key}"></button>
    `;
    filtersDiv.appendChild(tag);
  });

  // Event listeners to remove filters
  filtersDiv.querySelectorAll("button[data-key]").forEach(btn => {
    btn.addEventListener("click", () => {
      const key = btn.dataset.key;
      switch (key) {
        case "search": searchInput.value = ""; break;
        case "niche": nicheFilter.value = ""; break;
        case "contentType": contentTypeFilter.value = ""; break;
        case "location": locationFilter.value = ""; break;
        case "platform": platformFilter.value = ""; break;
      }
      filterCreators(); // re-run filter
    });
  });

    // If no filters, show fallback message
  if (filters.length === 0) {
    const noFilters = document.createElement("div");
noFilters.innerHTML = `<i class="bi bi-funnel-fill me-1"></i>No filters applied`;
    filtersDiv.appendChild(noFilters);
    return;
  }
}



searchInput.addEventListener("input", filterCreators);
nicheFilter.addEventListener("change", filterCreators);
contentTypeFilter.addEventListener("change", filterCreators);
locationFilter.addEventListener("change", filterCreators);
platformFilter.addEventListener("change", filterCreators);
resetFiltersBtn.addEventListener("click", resetAllFilters);

fetchCreators();
updateActiveFilters();
handleExploreSearchParam();


  </script>

</body>
</html>
